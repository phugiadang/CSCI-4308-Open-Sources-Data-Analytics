!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cp=e()}}(function(){var e;return function t(e,n,r){function i(o,s){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t,n){},{}],2:[function(e,t,n){t.exports={hcluster:e("./hcluster"),Kmeans:e("./kmeans"),kmeans:e("./kmeans").kmeans}},{"./hcluster":4,"./kmeans":5}],3:[function(e,t,n){t.exports={euclidean:function(e,t){for(var n=0,r=0;r<e.length;r++)n+=Math.pow(t[r]-e[r],2);return Math.sqrt(n)},manhattan:function(e,t){for(var n=0,r=0;r<e.length;r++)n+=Math.abs(t[r]-e[r]);return n},max:function(e,t){for(var n=0,r=0;r<e.length;r++)n=Math.max(n,Math.abs(t[r]-e[r]));return n}}},{}],4:[function(e,t,n){var r=e("./distance"),i=function(e,t,n){this.distance=e,this.linkage=t,this.threshold=void 0==n?1/0:n};i.prototype={cluster:function(e,t,n){this.clusters=[],this.dists=[],this.mins=[],this.index=[];for(var r=0;r<e.length;r++){var i={value:e[r],key:r,index:r,size:1};this.clusters[r]=i,this.index[r]=i,this.dists[r]=[],this.mins[r]=0}for(var r=0;r<this.clusters.length;r++)for(var a=0;r>=a;a++){var o=r==a?1/0:this.distance(this.clusters[r].value,this.clusters[a].value);this.dists[r][a]=o,this.dists[a][r]=o,o<this.dists[r][this.mins[r]]&&(this.mins[r]=a)}for(var s=this.mergeClosest(),r=0;s;)n&&r++%t==0&&n(this.clusters),s=this.mergeClosest();return this.clusters.forEach(function(e){delete e.key,delete e.index}),this.clusters},mergeClosest:function(){for(var e=0,t=1/0,n=0;n<this.clusters.length;n++){var r=this.clusters[n].key,i=this.dists[r][this.mins[r]];t>i&&(e=r,t=i)}if(t>=this.threshold)return!1;var a=this.index[e],o=this.index[this.mins[e]],s={left:a,right:o,key:a.key,size:a.size+o.size};this.clusters[a.index]=s,this.clusters.splice(o.index,1),this.index[a.key]=s;for(var n=0;n<this.clusters.length;n++){var i,u=this.clusters[n];a.key==u.key?i=1/0:"single"==this.linkage?(i=this.dists[a.key][u.key],this.dists[a.key][u.key]>this.dists[o.key][u.key]&&(i=this.dists[o.key][u.key])):"complete"==this.linkage?(i=this.dists[a.key][u.key],this.dists[a.key][u.key]<this.dists[o.key][u.key]&&(i=this.dists[o.key][u.key])):i="average"==this.linkage?(this.dists[a.key][u.key]*a.size+this.dists[o.key][u.key]*o.size)/(a.size+o.size):this.distance(u.value,a.value),this.dists[a.key][u.key]=this.dists[u.key][a.key]=i}for(var n=0;n<this.clusters.length;n++){var c=this.clusters[n].key;if(this.mins[c]==a.key||this.mins[c]==o.key){for(var t=c,l=0;l<this.clusters.length;l++){var f=this.clusters[l].key;this.dists[c][f]<this.dists[c][t]&&(t=f)}this.mins[c]=t}this.clusters[n].index=n}return delete a.key,delete o.key,delete a.index,delete o.index,!0}};var a=function(e,t,n,a,o,s){t=t||"euclidean",n=n||"average","string"==typeof t&&(t=r[t]);var u=new i(t,n,a).cluster(e,o,s);return void 0===a?u[0]:u};t.exports=a},{"./distance":3}],5:[function(e,t,n){function r(e){this.centroids=e||[]}var i=e("./distance");r.prototype.randomCentroids=function(e,t){var n=e.slice(0);return n.sort(function(){return Math.round(Math.random())-.5}),n.slice(0,t)},r.prototype.classify=function(e,t){var n=1/0,r=0;t=t||"euclidean","string"==typeof t&&(t=i[t]);for(var a=0;a<this.centroids.length;a++){var o=t(e,this.centroids[a]);n>o&&(n=o,r=a)}return r},r.prototype.cluster=function(e,t,n,r,a){t=t||Math.max(2,Math.ceil(Math.sqrt(e.length/2))),n=n||"euclidean","string"==typeof n&&(n=i[n]),this.centroids=this.randomCentroids(e,t);for(var o=new Array(e.length),s=new Array(t),u=0,c=!0;c;){for(var l=0;l<e.length;l++)o[l]=this.classify(e[l],n);c=!1;for(var f=0;t>f;f++){for(var d=[],l=0;l<o.length;l++)o[l]==f&&d.push(e[l]);if(d.length){for(var p=this.centroids[f],g=new Array(p.length),m=0;m<p.length;m++){for(var h=0,l=0;l<d.length;l++)h+=d[l][m];g[m]=h/d.length,g[m]!=p[m]&&(c=!0)}this.centroids[f]=g,s[f]=d}}a&&u++%r==0&&a(s)}return s},r.prototype.toJSON=function(){return JSON.stringify(this.centroids)},r.prototype.fromJSON=function(e){return this.centroids=JSON.parse(e),this},t.exports=r,t.exports.kmeans=function(e,t){return(new r).cluster(e,t)}},{"./distance":3}],6:[function(e,t,n){"use strict";function r(e,t){var n=r.distance.table(e),u=a.hcluster(e,function(e,t){var r=i.shorten(e),a=i.shorten(t);return n[r][a]},"average",o.CLUSTER_THRESHOLD),c=u.map(function(e){return s.traverse(e,[])}).map(function(e){return e.sort(function(e,t){return t._info.score-e._info.score})}).filter(function(e){return e.length>0}).sort(function(e,t){return t[0]._info.score-e[0]._info.score});return c.dist=n,c}t.exports=r;var i=e("vega-lite/src/shorthand"),a=e("clusterfck"),o=e("./clusterconsts"),s=e("../util");r.distance=e("./distance")},{"../util":19,"./clusterconsts":7,"./distance":8,clusterfck:2,"vega-lite/src/shorthand":52}],7:[function(e,t,n){"use strict";function r(e,t){var n=t[0],r=t[1],i=t[2];return e[n]=e[n]||{},e[r]=e[r]||{},e[n][r]=e[r][n]=i,e}var i=t.exports={};i.SWAPPABLE=.05,i.DIST_MISSING=1,i.CLUSTER_THRESHOLD=1,i.DIST_BY_CHANNEL=[["x","y",i.SWAPPABLE],["row","column",i.SWAPPABLE],["color","shape",i.SWAPPABLE],["color","detail",i.SWAPPABLE],["detail","shape",i.SWAPPABLE],["size","color",i.SWAPPABLE]].reduce(r,{})},{}],8:[function(e,t,n){"use strict";var r=e("vega-lite/src/spec"),i=e("vega-lite/src/shorthand"),a=e("./clusterconsts"),o=e("../util"),s={};t.exports=s,s.table=function(e){var t,n,r=e.length,a=e.map(function(e){return s.extendSpecWithChannelByColumnName(e)}),o=e.map(i.shorten),u={};for(t=0;r>t;t++)u[o[t]]={};for(t=0;r>t;t++)for(n=t+1;r>n;n++){var c=o[n],l=o[t];u[c][l]=u[l][c]=s.get(a[t],a[n])}return u},s.get=function(e,t){var n=o.union(o.keys(e.channelByField),o.keys(t.channelByField)),i=0;n.forEach(function(n){var r=e.channelByField[n],o=t.channelByField[n];r&&o?r.channel!=o.channel&&(i+=(a.DIST_BY_CHANNEL[r.channel]||{})[o.channel]||1):i+=a.DIST_MISSING});var s=r.isStack(e),u=r.isStack(t);return(s||u)&&(s&&u?(e.encoding.color&&t.encoding.color&&e.encoding.color.field!==t.encoding.color.field||e.encoding.detail&&t.encoding.detail&&e.encoding.detail.field!==t.encoding.detail.field)&&(i+=1):i+=1),i},s.extendSpecWithChannelByColumnName=function(e){var t={},n=e.encoding;return o.keys(n).forEach(function(e){var r=o.duplicate(n[e]);r.channel=e,t[r.field||""]=r,delete r.field}),{mark:e.mark,channelByField:t,encoding:e.encoding}}},{"../util":19,"./clusterconsts":7,"vega-lite/src/shorthand":52,"vega-lite/src/spec":53}],9:[function(e,t,n){"use strict";var r=t.exports={gen:{},cluster:{},rank:{}};r.X="x",r.Y="y",r.ROW="row",r.COL="column",r.SIZE="size",r.SHAPE="shape",r.COLOR="color",r.TEXT="text",r.DETAIL="detail",r.Type={},r.Type.Nominal="nominal",r.Type.Ordinal="ordinal",r.Type.Quantitative="quantitative",r.Type.Temporal="temporal",r.gen.projections={type:"object",properties:{omitDotPlot:{type:"boolean","default":!1,description:"remove all dot plots"},maxCardinalityForAutoAddOrdinal:{type:"integer","default":50,description:"max cardinality for an ordinal variable to be considered for auto adding"},alwaysAddHistogram:{type:"boolean","default":!0}}},r.gen.aggregates={type:"object",properties:{config:{type:"object"},data:{type:"object"},tableTypes:{type:"boolean","default":"both","enum":["both","aggregated","disaggregated"]},genDimQ:{type:"string","default":"auto","enum":["auto","bin","cast","none"],description:"Use Q as Dimension either by binning or casting"},minCardinalityForBin:{type:"integer","default":20,description:"minimum cardinality of an ordinal variable if we were to bin"},omitDotPlot:{type:"boolean","default":!1,description:"remove all dot plots"},omitMeasureOnly:{type:"boolean","default":!1,description:"Omit aggregation with measure(s) only"},omitDimensionOnly:{type:"boolean","default":!0,description:"Omit aggregation with dimension(s) only"},addCountForDimensionOnly:{type:"boolean","default":!0,description:"Add count when there are dimension(s) only"},aggrList:{type:"array",items:{type:["string"]},"default":[void 0,"mean"]},timeUnitList:{type:"array",items:{type:["string"]},"default":["year"]},consistentAutoQ:{type:"boolean","default":!0,description:"generate similar auto transform for quant"}}},r.gen.encodings={type:"object",properties:{markList:{type:"array",items:{type:"string"},"default":["point","bar","line","area","text","tick"],description:"allowed marks"},encodingTypeList:{type:"array",items:{type:"string"},"default":["x","y","row","column","size","color","text","detail"],description:"allowed encoding types"},requiredEncodings:{type:"object","default":void 0,description:"required encodings for each mark type"},supportedEncodings:{type:"object","default":void 0,description:"supported encoding for each mark type"},maxGoodCardinalityForFacets:{type:"integer","default":5,description:"maximum cardinality of an ordinal variable to be put on facet (row/column) effectively"},maxCardinalityForFacets:{type:"integer","default":20,description:"maximum cardinality of an ordinal variable to be put on facet (row/column)"},maxGoodCardinalityForColor:{type:"integer","default":7,description:"maximum cardinality of an ordinal variable to be put on color effectively"},maxCardinalityForColor:{type:"integer","default":20,description:"maximum cardinality of an ordinal variable to be put on color"},maxCardinalityForShape:{type:"integer","default":6,description:"maximum cardinality of an ordinal variable to be put on shape"},omitTranpose:{type:"boolean","default":!0,description:"Eliminate all transpose by (1) keeping horizontal dot plot only (2) for OxQ charts, always put O on Y (3) show only one DxD, MxM (currently sorted by name)"},omitDotPlot:{type:"boolean","default":!1,description:"remove all dot plots"},omitDotPlotWithExtraEncoding:{type:"boolean","default":!0,description:"remove all dot plots with >1 encoding"},omitMultipleRetinalEncodings:{type:"boolean","default":!0,description:"omit using multiple retinal variables (size, color, shape)"},omitNonTextAggrWithAllDimsOnFacets:{type:"boolean","default":!0,description:"remove all aggregated charts (except text tables) with all dims on facets (row, column)"},omitOneDimensionCount:{type:"boolean","default":!1,description:"omit one dimension count"},omitSizeOnBar:{type:"boolean","default":!1,description:"do not use bar's size"},omitStackedAverage:{type:"boolean","default":!0,description:"do not stack bar chart with average"},alwaysGenerateTableAsHeatmap:{type:"boolean","default":!0}}}},{}],10:[function(e,t,n){t.exports={consts:e("./consts"),cluster:e("./cluster/cluster"),gen:e("./gen/gen"),rank:e("./rank/rank"),util:e("./util"),auto:"-, sum"}},{"./cluster/cluster":6,"./consts":9,"./gen/gen":13,"./rank/rank":17,"./util":19}],11:[function(e,t,n){"use strict";function r(e,t,n,r){function f(t){t=c.duplicate(t),t.key=t.map(function(e){return o.shortenFieldDef(e)}).join(o.DELIM),e.push(t)}function d(){if(r.omitMeasureOnly||r.omitDimensionOnly){var e=!1,t=!1,n=!1;if(b.forEach(function(r){i.isDimension(r)?t=!0:(e=!0,r.aggregate||(n=!0))}),!t&&!n&&r.omitMeasureOnly)return;if(!e&&(r.addCountForDimensionOnly&&(b.push(i.count()),f(b),b.pop()),r.omitDimensionOnly))return}r.omitDotPlot&&1===b.length||f(b)}function p(e,t,n,r){var i=t===!0||null===t,a=t===!1||null===t;r?i&&(b[e].aggregate=r,v(e+1,!0,n),delete b[e].aggregate):a&&v(e+1,!1,n)}function g(e,t,n){b[e].bin=!0,v(e+1,t,n),delete b[e].bin}function m(e,a,o){var s=t[e],f=a===!0||null===a;if(b[e]={field:s.field,type:s.type},"count"===s.aggregate)f&&(b[e].aggregate=s.aggregate,v(e+1,!0,o));else if(s._aggregate)p(e,a,o,s._aggregate);else if(s._raw)p(e,a,o,void 0);else if(s._bin)g(e,a,o);else if(r.aggrList.forEach(function(t){r.consistentAutoQ&&o!==l&&o!==t||p(e,a,t,t)}),(!r.consistentAutoQ||c.isin(o,[l,"bin","cast","autocast"]))&&!T){var d=i.cardinality(s,n)>r.minCardinalityForBin,m="auto"===r.genDimQ,h="bin"===r.genDimQ||m&&d,y="cast"===r.genDimQ||m&&!d;h&&c.isin(o,[l,"bin","autocast"])&&g(e,a,m?"autocast":"bin"),y&&c.isin(o,[l,"cast","autocast"])&&(b[e].type=u.Ordinal,v(e+1,a,m?"autocast":"cast"),b[e].type=u.Quantitative)}}function h(e,t,n,r){b[e].timeUnit=r,v(e+1,t,n),delete b[e].timeUnit}function y(e,n,i){var a=t[e];b[e]={field:a.field,type:a.type},a._timeUnit?h(e,n,i,a._timeUnit):r.timeUnitList.forEach(function(t){void 0===t?n||v(e+1,!1,i):h(e,n,i,t)})}function v(e,n,r){if(e===t.length)return void d();var i=t[e];switch(i.type){case u.Quantitative:m(e,n,r);break;case u.Temporal:y(e,n,r);break;case u.Ordinal:case u.Nominal:default:b[e]=i,v(e+1,n,r)}}r=a.extend(r||{},s.gen.aggregates);var b=new Array(t.length),T=c.any(t,function(e){return e.type===u.Nominal||e.type==u.Ordinal}),x="aggregated"===r.tableTypes?!0:"disaggregated"===r.tableTypes?!1:null;return v(0,x,l),e}var i=e("vega-lite/src/fielddef"),a=e("vega-lite/src/schema/schemautil"),o=e("vega-lite/src/shorthand"),s=e("../consts"),u=s.Type,c=e("../util"),l="*";t.exports=r},{"../consts":9,"../util":19,"vega-lite/src/fielddef":35,"vega-lite/src/schema/schemautil":50,"vega-lite/src/shorthand":52}],12:[function(e,t,n){"use strict";function r(e,t,n,r){return r.omitMultipleRetinalEncodings&&(e.color||e.size||e.shape)?!1:!0}function i(e,t,n,i){return r(e,t,n,i)?c.isMeasure(t)||c.cardinality(t,n)<=i.maxCardinalityForColor:!1}function a(e,t,n,i){return r(e,t,n,i)?t.bin&&t.type===h.Quantitative?!1:t.timeUnit&&t.type===h.Temporal?!1:c.cardinality(t,n)<=i.maxCardinalityForColor:!1}function o(e){return e.y.type!==h.Nominal&&e.y.type!==h.Ordinal||!g(e.x)?g(e.y)&&e.x.type!==h.Nominal&&e.x.type!==h.Ordinal&&p(e.x)?!0:!1:!0}function s(e,t,n){if(e.text)return d.satisfyRules(e,"text",t,n);if(e.x||e.y||e.geo||e.arc){if(e.row||e.column){if(!e.x||!e.y)return!1;if(n.omitNonTextAggrWithAllDimsOnFacets&&u.isAggrWithAllDimOnFacets(e))return!1}if(e.x&&e.y){var r=!!p(e.x),i=!!p(e.y);if(r&&i&&!l.isAggregate(e))return!1;if(n.omitTranpose)if(r^i){if(!o(e))return!1}else if(e.y.type===h.Temporal||e.x.type===h.Temporal){if(e.y.type===h.Temporal&&e.x.type!==h.Temporal)return!1}else if(e.x.field>e.y.field)return!1;return!0}if(n.omitDotPlot)return!1;if(n.omitTranpose&&e.y)return!1;if(n.omitDotPlotWithExtraEncoding&&f.keys(e).length>1)return!1;if(n.omitOneDimensionCount){if(e.x&&"count"==e.x.aggregate&&!e.y)return!1;if(e.y&&"count"==e.y.aggregate&&!e.x)return!1}return!0}return!1}function u(e,t,n,r){function i(o){if(o===t.length)return void(s(a,n,r)&&e.push(f.duplicate(a)));var u=t[o];for(var c in r.encodingTypeList){var l=r.encodingTypeList[c],d=p(u);l in a||!(d&&y[l].dimension||!d&&y[l].measure)||y[l].rules&&!y[l].rules(a,u,n,r)||(a[l]=u,i(o+1),delete a[l])}}var a={};return i(0),e}var c=e("vega-lite/src/fielddef"),l=e("vega-lite/src/encoding"),f=e("../util"),d=e("./marks"),p=c.isDimension,g=c.isMeasure,m=e("../consts"),h=m.Type;t.exports=u;var y={x:{dimension:!0,measure:!0,multiple:!0},y:{dimension:!0,measure:!0,multiple:!0},row:{dimension:!0,multiple:!0},column:{dimension:!0,multiple:!0},shape:{dimension:!0,rules:a},size:{measure:!0,rules:r},color:{dimension:!0,measure:!0,rules:i},text:{measure:!0},detail:{dimension:!0}};u.isAggrWithAllDimOnFacets=function(e){var t=!1,n=!1;for(var r in e){var i=e[r];if(i.aggregate&&(t=!0),c.isDimension(i)&&r!==m.ROW&&r!==m.COL&&(n=!0),t&&n)break}return t&&!n}},{"../consts":9,"../util":19,"./marks":14,"vega-lite/src/encoding":34,"vega-lite/src/fielddef":35}],13:[function(e,t,n){"use strict";var r=e("../util"),i=t.exports={aggregates:e("./aggregates"),projections:e("./projections"),specs:e("./specs"),encodings:e("./encodings"),marks:e("./marks")};i.charts=function(e,t,n,a){t=r.gen.getOpt(t),a=void 0===a?{encodings:1}:a;var o,s,u=t.genAggr?i.aggregates([],e,t):[e],c=0;return a===!0||a&&a.aggregate?o=u.reduce(function(e,n){return i.encs(e,n,t)},[]):(o=u.map(function(e){return i.encs([],e,t)},!0),c+=1),a===!0||a&&a.encodings?s=r.nestedReduce(o,function(e,r){return i.marks(e,r,t,n)},c,!0):(s=r.nestedMap(o,function(e){return i.marks([],e,t,n)},c,!0),c+=1),s}},{"../util":19,"./aggregates":11,"./encodings":12,"./marks":14,"./projections":15,"./specs":16}],14:[function(e,t,n){"use strict";function r(e,t,n){return n.markList.filter(function(r){return b.satisfyRules(e,r,t,n)})}function i(e,t,n){return p.cardinality(e,t)<=n.maxCardinalityForFacets}function a(e,t,n){return e.row&&!i(e.row,t,n)?!1:e.column&&!i(e.column,t,n)?!1:!0}function o(e,t,n){if(!a(e,t,n))return!1;if(e.x&&e.y){var r=m(e.x),i=m(e.y);if(r&&i){if(e.shape)return!1;if(e.color&&m(e.color))return!1}}else{if(n.omitDotPlot)return!1;if(n.omitTranpose&&e.y)return!1;if(n.omitDotPlotWithExtraEncoding&&h.keys(e).length>1)return!1;if(e.shape)return!1}return!0}function s(e,t,n){if(e.x||e.y){if(d.isAggregate(e))return!1;var r=m(e.x),i=m(e.y);return!r&&(!e.y||i)||!i&&(!e.x||r)}return!1}function u(e,t,n){if(!a(e,t,n))return!1;if(!e.x&&!e.y)return!1;if(n.omitSizeOnBar&&void 0!==e.size)return!1;var r=(!e.x||void 0===e.x.aggregate)^(!e.y||void 0===e.y.aggregate);if(r){var i=(!e.x||m(e.x))^(!e.y||m(e.y));if(i){var o=e.x.aggregate||e.y.aggregate;return!(n.omitStackedAverage&&"mean"===o&&e.color)}}return!1}function c(e,t,n){return a(e,t,n)?e.x.type==v.Temporal&&e.x.timeUnit&&e.y.type==v.Quantitative&&e.y.aggregate:!1}function l(e,t,n){return a(e,t,n)&&c(e,t,n)?!(n.omitStackedAverage&&"mean"===e.y.aggregate&&e.color):!1}function f(e,t,n){return(e.row||e.column)&&e.text&&e.text.aggregate&&!e.x&&!e.y&&!e.size&&(!n.alwaysGenerateTableAsHeatmap||!e.color)}var d=e("vega-lite/src/encoding"),p=e("vega-lite/src/fielddef"),g=e("vega-lite/src/validate"),m=p.isDimension,h=e("../util"),y=e("../consts"),v=y.Type,b=t.exports=r,T=b.rule={point:o,bar:u,line:c,area:l,text:f,tick:s};b.satisfyRules=function(e,t,n,r){return null===g.getEncodingMappingError({mark:t,encoding:e})&&(!T[t]||T[t](e,n,r))}},{"../consts":9,"../util":19,"vega-lite/src/encoding":34,"vega-lite/src/fielddef":35,"vega-lite/src/validate":57}],15:[function(e,t,n){"use strict";function r(e,t,n){n=o.extend(n||{},u.gen.projections);var l=[],f=[],d=[],p=!1,g=!1,m={};e.forEach(function(e,r){if(m[e.field]=r,e.selected)l.push(e),c(e)||"temporal"===e.type?p=!0:g=!0;else if(e.selected!==!1&&!a.isCount(e)){if(a.isDimension(e)&&!n.maxCardinalityForAutoAddOrdinal&&a.cardinality(e,t,15)>n.maxCardinalityForAutoAddOrdinal)return;f.push(e)}}),f.sort(i(p,g,m));var h=s.chooseKorLess(f,1);return h.forEach(function(e){var t=l.concat(e);if(t.length>0){if(n.omitDotPlot&&1===t.length)return;d.push(t)}}),d.forEach(function(e){e.key=r.key(e)}),d}function i(e,t,n){return function(t,r){return t.type!==r.type?e?l[r.type]-l[t.type]:l[t.type]-l[r.type]:n[t.field]-n[r.field]}}var a=e("vega-lite/src/fielddef"),o=e("vega-lite/src/schema/schemautil"),s=e("../util"),u=e("../consts"),c=a.isDimension;t.exports=r;var l={nominal:0,ordinal:0,temporal:2,quantitative:3};r.key=function(e){return e.map(function(e){return a.isCount(e)?"count":e.field}).join(",")}},{"../consts":9,"../util":19,"vega-lite/src/fielddef":35,"vega-lite/src/schema/schemautil":50}],16:[function(e,t,n){"use strict";function r(e,t,n,r,a){r=s.extend(r||{},d.gen.encodings);var o=c([],t,n,r);return a?o.reduce(function(e,t){return e[t]=i([],t,n,r),e},{}):o.reduce(function(e,t){return i(e,t,n,r)},[])}function i(e,t,n,r){return l(t,n,r).forEach(function(i){var o=u.duplicate({encoding:t,config:r.config});o.mark=i,o.data=r.data,o=a(o,n,r);var s=f.encoding(o,n,r);o._info=s,e.push(o)}),e}function a(e,t,n){"text"===e.mark&&n.alwaysGenerateTableAsHeatmap&&(e.encoding.color=e.encoding.text);var r=e.encoding;return["x","y"].forEach(function(e){var n=r[e];if(n&&o.isMeasure(n)&&!o.isCount(n)){var i=t[n.field];i&&i.stdev/i.mean<.01&&(n.scale={zero:!1})}}),e}var o=e("vega-lite/src/fielddef"),s=e("vega-lite/src/schema/schemautil"),u=e("../util"),c=e("./encodings"),l=e("./marks"),f=e("../rank/rank"),d=e("../consts");t.exports=r},{"../consts":9,"../rank/rank":17,"../util":19,"./encodings":12,"./marks":14,"vega-lite/src/fielddef":35,"vega-lite/src/schema/schemautil":50}],17:[function(e,t,n){t.exports={encoding:e("./rankEncodings")}},{"./rankEncodings":18}],18:[function(e,t,n){"use strict";function r(e,t,n,o){var l=[],f=u.keys(e.encoding),g=e.mark,m=e.encoding,h=i.reduce(e.encoding,function(e,t,n){var r=c.shortenFieldDef(t),i=e[r]=e[r]||[];return i.push({channel:n,fieldDef:t}),e},{});return u.forEach(h,function(i){var s=i.map(function(e){return e.channel+c.Assign+c.shortenFieldDef(e.fieldDef)+" "+(o&&o[e.fieldDef.field]?"[x]":"[ ]")}),u=i.map(function(i){var s=a.isDimension(i.fieldDef)?"dimension":"measure",u=r.score[s](i.fieldDef,i.channel,e.mark,t,n);return!o||o[i.fieldDef.field]?u:Math.pow(u,.125)});l.push({reason:s.join(" | "),score:Math.max.apply(null,u)})}),"text"===g||m.x&&m.y&&s(m.x)^s(m.y)&&l.push({reason:"OxQ plot",score:.8}),f.length>1&&"text"!==g&&(m.x&&m.y||m.geo||m.text||l.push({reason:"unused position",score:d})),l.push({reason:"mark="+g,score:p[g]}),{score:l.reduce(function(e,t){return e*t.score},1),features:l}}var i=e("vega-lite/src/encoding"),a=e("vega-lite/src/fielddef"),o=e("vega-lite/src/channel"),s=a.isDimension,u=e("../util"),c=e("vega-lite/src/shorthand"),l=e("../consts"),f=l.Type;t.exports=r;var d=.5,p={line:.99,area:.98,bar:.97,tick:.96,point:.95,circle:.94,square:.94,text:.8},g={},m={},h=.1,y=.01;g.minor=.01,g.pos=1,g.Y_T=.8,g.facet_text=1,g.facet_good=.675,g.facet_ok=.55,g.facet_bad=.4,g.color_good=.7,g.color_ok=.65,g.color_bad=.3,g.color_stack=.6,g.shape=.6,g.detail=.5,g.bad=h,g.terrible=y,m.pos=1,m.size=.6,m.color=.5,m.text=.4,m.bad=h,m.terrible=y,r.dimensionScore=function(e,t,n,r,i){var s=a.cardinality(e,r);switch(t){case o.X:return e.type===f.Nominal||e.type===f.Ordinal?g.pos-g.minor:g.pos;case o.Y:return e.type===f.Nominal||e.type===f.Ordinal?g.pos-g.minor:e.type===f.Temporal?g.Y_T:g.pos-g.minor;case o.COL:return"text"===n?g.facet_text:s<=i.maxGoodCardinalityForFacets?g.facet_good:s<=i.maxCardinalityForFacets?g.facet_ok:g.facet_bad;case o.ROW:return"text"===n?g.facet_text:(s<=i.maxGoodCardinalityForFacets?g.facet_good:s<=i.maxCardinalityForFacets?g.facet_ok:g.facet_bad)-g.minor;case o.COLOR:var u=e.bin&&e.type===f.Quantitative||e.timeUnit&&e.type===f.Temporal,c="bar"===n||"area"===n;return u?g.color_bad:c?g.color_stack:s<=i.maxGoodCardinalityForColor?g.color_good:s<=i.maxCardinalityForColor?g.color_ok:g.color_bad;case o.SHAPE:return s<=i.maxCardinalityForShape?g.shape:y;case o.DETAIL:return g.detail}return y},r.dimensionScore.consts=g,r.measureScore=function(e,t,n,r,i){switch(t){case o.X:return m.pos;case o.Y:return m.pos;case o.SIZE:return"bar"===n?h:"text"===n?h:"line"===n?h:m.size;case o.COLOR:return m.color;case o.TEXT:return m.text}return h},r.measureScore.consts=m,r.score={dimension:r.dimensionScore,measure:r.measureScore}},{"../consts":9,"../util":19,"vega-lite/src/channel":29,"vega-lite/src/encoding":34,"vega-lite/src/fielddef":35,"vega-lite/src/shorthand":52}],19:[function(e,t,n){"use strict";var r=e("./consts"),i=t.exports={gen:{}};i.isArray=Array.isArray||function(e){return"[object Array]"=={}.toString.call(e)},i.isin=function(e,t){return-1!==t.indexOf(e)},i.json=function(e,t){return JSON.stringify(e,null,t)},i.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.forEach=function(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)},i.any=function(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1},i.nestedMap=function(e,t,n,r){return 0===n?e.map(t):e.map(function(e){var a=i.nestedMap(e,t,n-1);return r?a.filter(i.nonEmpty):a})},i.nestedReduce=function(e,t,n,r){return 0===n?e.reduce(t,[]):e.map(function(e){var a=i.nestedReduce(e,t,n-1);return r?a.filter(i.nonEmpty):a})},i.nonEmpty=function(e){return!i.isArray(e)||e.length>0},i.traverse=function(e,t){return void 0!==e.value?t.push(e.value):(e.left&&i.traverse(e.left,t),e.right&&i.traverse(e.right,t)),t},i.union=function(e,t){var n={};return e.forEach(function(e){n[e]=!0}),t.forEach(function(e){n[e]=!0}),i.keys(n)},i.gen.getOpt=function(e){return(e?i.keys(e):[]).reduce(function(t,n){return t[n]=e[n],t},Object.create(r.gen.DEFAULT_OPT))},i.powerset=function(e){for(var t=[[]],n=0;n<e.length;n++)for(var r=0,i=t.length;i>r;r++)t.push(t[r].concat(e[n]));return t},i.chooseKorLess=function(e,t){for(var n=[[]],r=0;r<e.length;r++)for(var i=0,a=n.length;a>i;i++){var o=n[i].concat(e[r]);o.length<=t&&n.push(o)}return n},i.chooseK=function(e,t){for(var n=[[]],r=[],i=0;i<e.length;i++)for(var a=0,o=n.length;o>a;a++){var s=n[a].concat(e[i]);s.length<t?n.push(s):s.length===t&&r.push(s)}return r},i.cross=function(e,t){for(var n=[],r=0;r<e.length;r++)for(var i=0;i<t.length;i++)n.push(e[r].concat(t[i]));return n}},{"./consts":9}],20:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(t.d3_time={})}(this,function(e){"use strict";function t(e,n,r,o){function s(t){return e(t=new Date(+t)),t}return s.floor=s,s.round=function(t){var r=new Date(+t),i=new Date(t-1);return e(r),e(i),n(i,1),i-t>t-r?r:i},s.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},s.offset=function(e,t){return n(e=new Date(+e),null==t?1:Math.floor(t)),e},s.range=function(t,r,i){var a=[];if(t=new Date(t-1),r=new Date(+r),i=null==i?1:Math.floor(i),!(r>t&&i>0))return a;for(n(t,1),e(t),r>t&&a.push(new Date(+t));n(t,i),e(t),r>t;)a.push(new Date(+t));return a},s.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(s.count=function(t,n){return i.setTime(+t),a.setTime(+n),e(i),e(a),Math.floor(r(i,a))},s.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?s.filter(o?function(t){return o(t)%e===0}:function(t){return s.count(0,t)%e===0}):s:null}),s}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,a=new Date,o=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});o.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):o:null};var s=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),u=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),c=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),f=n(0),d=n(1),p=n(2),g=n(3),m=n(4),h=n(5),y=n(6),v=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),b=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),T=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),x=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),A=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),k=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),M=r(0),E=r(1),O=r(2),D=r(3),C=r(4),w=r(5),S=r(6),N=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),L=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),I=o.range,U=s.range,_=u.range,R=c.range,F=l.range,P=f.range,$=d.range,j=p.range,q=g.range,Y=m.range,z=h.range,H=y.range,W=f.range,B=v.range,V=b.range,Q=o,X=I,G=T.range,J=x.range,K=A.range,Z=k.range,ee=M.range,te=E.range,ne=O.range,re=D.range,ie=C.range,ae=w.range,oe=S.range,se=M.range,ue=N.range,ce=L.range,le="0.1.0";e.version=le,e.milliseconds=I,e.seconds=U,e.minutes=_,e.hours=R,e.days=F,e.sundays=P,e.mondays=$,e.tuesdays=j,e.wednesdays=q,e.thursdays=Y,e.fridays=z,e.saturdays=H,e.weeks=W,e.months=B,e.years=V,e.utcMillisecond=Q,e.utcMilliseconds=X,e.utcSeconds=G,e.utcMinutes=J,e.utcHours=K,e.utcDays=Z,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=ae,e.utcSaturdays=oe,e.utcWeeks=se,e.utcMonths=ue,e.utcYears=ce,e.millisecond=o,e.second=s,e.minute=u,e.hour=c,e.day=l,e.sunday=f,e.monday=d,e.tuesday=p,e.wednesday=g,e.thursday=m,e.friday=h,e.saturday=y,e.week=f,e.month=v,e.year=b,e.utcSecond=T,e.utcMinute=x,e.utcHour=A,e.utcDay=k,e.utcSunday=M,e.utcMonday=E,e.utcTuesday=O,e.utcWednesday=D,e.utcThursday=C,e.utcFriday=w,e.utcSaturday=S,e.utcWeek=M,e.utcMonth=N,e.utcYear=L,e.interval=t})},{}],21:[function(e,t,n){function r(e){if(!e)throw Error("Missing binning options.");var t,n,r,s,u,c,l,f=e.maxbins||15,d=e.base||10,p=Math.log(d),g=e.div||[5,2],m=e.min,h=e.max,y=h-m;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,y/f,0,e.steps.length))];else{n=Math.ceil(Math.log(f)/p),r=e.minstep||0,t=Math.max(r,Math.pow(d,Math.round(Math.log(y)/p)-n));do t*=d;while(Math.ceil(y/t)>f);for(c=0;c<g.length;++c)u=t/g[c],u>=r&&f>=y/u&&(t=u)}return u=Math.log(t),s=u>=0?0:~~(-u/p)+1,l=Math.pow(d,-s-1),m=Math.min(m,Math.floor(m/t+l)*t),h=Math.ceil(h/t)*t,{start:m,stop:h,step:t,unit:{precision:s},value:a,index:o}}function i(e,t,n,r){for(;r>n;){var i=n+r>>>1;c.cmp(e[i],t)<0?n=i+1:r=i}return n}function a(e){return this.step*Math.floor(e/this.step+f)}function o(e){return Math.floor((e-this.start)/this.step+f)}function s(e){return this.unit.date(a.call(this,e))}function u(e){return o.call(this,this.unit.unit(e))}var c=e("../util"),l=e("../time"),f=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?l.utc:l,n=e.min,i=e.max,a=e.maxbins||20,o=e.minbins||4,c=+i-+n,f=e.unit?t[e.unit]:t.find(c,o,a),d=r({min:null!=f.min?f.min:f.unit(n),max:null!=f.max?f.max:f.unit(i),maxbins:a,minstep:f.minstep,steps:f.step});return d.unit=f,d.index=u,e.raw||(d.value=s),d},t.exports=r},{"../time":25,"../util":26}],22:[function(e,t,n){var r=t.exports={};r.repeat=function(e,t){var n,r=Array(t);for(n=0;t>n;++n)r[n]=e;return r},r.zeros=function(e){return r.repeat(0,e)},r.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],a=-1;if(0>n)for(;(r=e+n*++a)>t;)i.push(r);else for(;(r=e+n*++a)<t;)i.push(r);return i},r.random={},r.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,i=function(){return e+n*Math.random()};return i.samples=function(e){
return r.zeros(e).map(i)},i.pdf=function(r){return r>=e&&t>=r?1/n:0},i.cdf=function(r){return e>r?0:r>t?1:(r-e)/n},i.icdf=function(t){return t>=0&&1>=t?e+t*n:NaN},i},r.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,i=function(){return e+Math.floor(n*Math.random())};return i.samples=function(e){return r.zeros(e).map(i)},i.pdf=function(r){return r===Math.floor(r)&&r>=e&&t>r?1/n:0},i.cdf=function(r){var i=Math.floor(r);return e>i?0:i>=t?1:(i-e+1)/n},i.icdf=function(t){return t>=0&&1>=t?e-1+Math.floor(t*n):NaN},i},r.random.normal=function(e,t){e=e||0,t=t||1;var n,i=function(){var r,i,a=0,o=0;if(void 0!==n)return a=n,n=void 0,a;do a=2*Math.random()-1,o=2*Math.random()-1,r=a*a+o*o;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=e+o*i*t,e+a*i*t};return i.samples=function(e){return r.zeros(e).map(i)},i.pdf=function(n){var r=Math.exp(Math.pow(n-e,2)/(-2*Math.pow(t,2)));return 1/(t*Math.sqrt(2*Math.PI))*r},i.cdf=function(n){var r,i=(n-e)/t,a=Math.abs(i);if(a>37)r=0;else{var o,s=Math.exp(-a*a/2);7.07106781186547>a?(o=.0352624965998911*a+.700383064443688,o=o*a+6.37396220353165,o=o*a+33.912866078383,o=o*a+112.079291497871,o=o*a+221.213596169931,o=o*a+220.206867912376,r=s*o,o=.0883883476483184*a+1.75566716318264,o=o*a+16.064177579207,o=o*a+86.7807322029461,o=o*a+296.564248779674,o=o*a+637.333633378831,o=o*a+793.826512519948,o=o*a+440.413735824752,r/=o):(o=a+.65,o=a+4/o,o=a+3/o,o=a+2/o,o=a+1/o,r=s/o/2.506628274631)}return i>0?1-r:r},i.icdf=function(n){if(0>=n||n>=1)return NaN;var r=2*n-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),a=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,o=Math.log(1-r*r)/i,s=(r>0?1:-1)*Math.sqrt(Math.sqrt(a*a-o)-a);return e+t*Math.SQRT2*s},i}},{}],23:[function(e,t,n){function r(e,t){return t?void(e[c]=t):e&&e[c]||null}function i(e,t){e=u.array(e),t=u.$(t);var n,r,i;if(e[c]&&(n=t(e[c]),u.isString(n)))return n;for(r=0,i=e.length;!u.isValid(n)&&i>r;++r)n=t?t(e[r]):e[r];return u.isDate(n)?"date":u.isNumber(n)?"number":u.isBoolean(n)?"boolean":u.isString(n)?"string":null}function a(e,t){return e.length?(t=t||u.keys(e[0]),t.reduce(function(t,n){return t[n]=i(e,n),t},{})):void 0}function o(e,t){e=u.array(e),t=u.$(t);var n,r,i,a=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<a.length;++r)u.isValid(i)&&!f[a[r]](i)&&(a.splice(r,1),r-=1);if(0===a.length)return"string"}return a[0]}function s(e,t){return t=t||u.keys(e[0]),t.reduce(function(t,n){return t[n]=o(e,n),t},{})}var u=e("../util"),c="__types__",l={"boolean":u["boolean"],integer:u.number,number:u.number,date:u.date,string:function(e){return""===e?null:e}},f={"boolean":function(e){return"true"===e||"false"===e||u.isBoolean(e)},integer:function(e){return f.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!u.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};i.annotation=r,i.all=a,i.infer=o,i.inferAll=s,i.parsers=l,t.exports=i},{"../util":26}],24:[function(e,t,n){var r=e("./util"),i=e("./import/type"),a=e("./generate"),o={};o.unique=function(e,t,n){t=r.$(t),n=n||[];var i,a,o,s={};for(a=0,o=e.length;o>a;++a)i=t?t(e[a]):e[a],i in s||(s[i]=1,n.push(i));return n},o.count=function(e){return e&&e.length||0},o.count.valid=function(e,t){t=r.$(t);var n,i,a,o=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],r.isValid(n)&&(o+=1);return o},o.count.missing=function(e,t){t=r.$(t);var n,i,a,o=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],null==n&&(o+=1);return o},o.count.distinct=function(e,t){t=r.$(t);var n,i,a,o={},s=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],n in o||(o[n]=1,s+=1);return s},o.count.map=function(e,t){t=r.$(t);var n,i,a,o={};for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],o[n]=n in o?o[n]+1:1;return o},o.median=function(e,t){return t&&(e=e.map(r.$(t))),e=e.filter(r.isValid).sort(r.cmp),o.quantile(e,.5)},o.quartile=function(e,t){t&&(e=e.map(r.$(t))),e=e.filter(r.isValid).sort(r.cmp);var n=o.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},o.quantile=function(e,t,n){void 0===n&&(n=t,t=r.identity),t=r.$(t);var i=(e.length-1)*n+1,a=Math.floor(i),o=+t(e[a-1]),s=i-a;return s?o+s*(t(e[a])-o):o},o.sum=function(e,t){t=r.$(t);for(var n,i=0,a=0,o=e.length;o>a;++a)n=t?t(e[a]):e[a],r.isValid(n)&&(i+=n);return i},o.mean=function(e,t){t=r.$(t);var n,i,a,o,s,u=0;for(i=0,o=0,a=e.length;a>i;++i)s=t?t(e[i]):e[i],r.isValid(s)&&(n=s-u,u+=n/++o);return u},o.variance=function(e,t){if(t=r.$(t),!r.isArray(e)||e.length<2)return 0;var n,i,a,o,s=0,u=0;for(i=0,a=0;i<e.length;++i)o=t?t(e[i]):e[i],r.isValid(o)&&(n=o-s,s+=n/++a,u+=n*(o-s));return u/=a-1},o.stdev=function(e,t){return Math.sqrt(o.variance(e,t))},o.modeskew=function(e,t){var n=o.mean(e,t),r=o.median(e,t),i=o.stdev(e,t);return 0===i?0:(n-r)/i},o.min=function(e,t){return o.extent(e,t)[0]},o.max=function(e,t){return o.extent(e,t)[1]},o.extent=function(e,t){t=r.$(t);var n,i,a,o,s=e.length;for(o=0;s>o;++o)if(a=t?t(e[o]):e[o],r.isValid(a)){n=i=a;break}for(;s>o;++o)a=t?t(e[o]):e[o],r.isValid(a)&&(n>a&&(n=a),a>i&&(i=a));return[n,i]},o.extent.index=function(e,t){t=r.$(t);var n,i,a,o,s=-1,u=-1,c=e.length;for(o=0;c>o;++o)if(a=t?t(e[o]):e[o],r.isValid(a)){n=i=a,s=u=o;break}for(;c>o;++o)a=t?t(e[o]):e[o],r.isValid(a)&&(n>a&&(n=a,s=o),a>i&&(i=a,u=o));return[s,u]},o.dot=function(e,t,n){var i,a,o=0;if(n)for(t=r.$(t),n=r.$(n),i=0;i<e.length;++i)a=t(e[i])*n(e[i]),a===a&&(o+=a);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(i=0;i<e.length;++i)a=e[i]*t[i],a===a&&(o+=a)}return o},o.dist=function(e,t,n,i){var a,o,s=r.isFunction(n)||r.isString(n),u=e,c=s?e:t,l=s?i:n,f=2===l||null==l,d=e.length,p=0;for(s&&(t=r.$(t),n=r.$(n)),o=0;d>o;++o)a=s?t(u[o])-n(c[o]):u[o]-c[o],p+=f?a*a:Math.pow(Math.abs(a),l);return f?Math.sqrt(p):Math.pow(p,1/l)},o.cohensd=function(e,t,n){var i=n?e.map(r.$(t)):e,a=n?e.map(r.$(n)):t,s=o.mean(i),u=o.mean(a),c=o.count.valid(i),l=o.count.valid(a);if(0>=c+l-2)return 0;var f=o.variance(i),d=o.variance(a),p=Math.sqrt(((c-1)*f+(l-1)*d)/(c+l-2));return 0===p?0:(s-u)/p},o.covariance=function(e,t,n){var i,a,s,u,c,l=n?e.map(r.$(t)):e,f=n?e.map(r.$(n)):t,d=l.length,p=o.mean(l),g=o.mean(f),m=0,h=0;if(d!==f.length)throw Error("Input lengths must match.");for(i=0;d>i;++i)if(a=l[i],u=r.isValid(a),s=f[i],c=r.isValid(s),u&&c)m+=(a-p)*(s-g),++h;else if(u||c)throw Error("Valid values must align.");return m/(h-1)},o.rank=function(e,t){t=r.$(t)||r.identity;var n,i,a,o=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(r.comparator("val")),s=e.length,u=Array(s),c=-1,l={};for(n=0;s>n;++n){if(i=o[n].val,0>c&&l===i)c=n-1;else if(c>-1&&l!==i){for(a=1+(n-1+c)/2;n>c;++c)u[o[c].idx]=a;c=-1}u[o[n].idx]=n+1,l=i}if(c>-1)for(a=1+(s-1+c)/2;s>c;++c)u[o[c].idx]=a;return u},o.cor=function(e,t,n){var i=n;n=i?e.map(r.$(n)):t,t=i?e.map(r.$(t)):e;var a=o.dot(t,n),s=o.mean(t),u=o.mean(n),c=o.stdev(t),l=o.stdev(n),f=e.length;return(a-f*s*u)/((f-1)*c*l)},o.cor.rank=function(e,t,n){var i,a,s,u=n?o.rank(e,r.$(t)):o.rank(e),c=n?o.rank(e,r.$(n)):o.rank(t),l=e.length;for(i=0,a=0;l>i;++i)s=u[i]-c[i],a+=s*s;return 1-6*a/(l*(l*l-1))},o.cor.dist=function(e,t,n){var i,a,s,u,c=n?e.map(r.$(t)):e,l=n?e.map(r.$(n)):t,f=o.dist.mat(c),d=o.dist.mat(l),p=f.length;for(i=0,a=0,s=0,u=0;p>i;++i)a+=f[i]*f[i],s+=d[i]*d[i],u+=f[i]*d[i];return Math.sqrt(u/Math.sqrt(a*s))},o.linearRegression=function(e,t,n){var i,a,s=n?e.map(r.$(t)):e,u=n?e.map(r.$(n)):t,c=s.length,l=o.covariance(s,u),f=o.stdev(s),d=o.stdev(u),p=l/(f*f),g=o.mean(u)-p*o.mean(s),m={slope:p,intercept:g,R:l/(f*d),rss:0};for(a=0;c>a;++a)r.isValid(s[a])&&r.isValid(u[a])&&(i=p*s[a]+g-u[a],m.rss+=i*i);return m},o.z={},o.z.ci=function(e,t){var n=t?a.random.normal(0,1).icdf(1-t/2):1.96,r=o.mean(e),i=o.stdev(e)/Math.sqrt(o.count.valid(e));return[r-n*i,r+n*i]},o.z.test=function(e,t){var n=t?t:0,r=a.random.normal(0,1),i=o.mean(e),s=o.stdev(e)/Math.sqrt(o.count.valid(e));if(0===s)return i-n===0?1:0;var u=(i-n)/s;return 2*r.cdf(-Math.abs(u))},o.z.pairedTest=function(e,t,n){var i,a=n?e.map(r.$(t)):e,s=n?e.map(r.$(n)):t,u=o.count(a),c=o.count(s),l=Array();if(u!==c)throw Error("Array lengths must match.");for(i=0;u>i;++i)r.isValid(a[i])&&r.isValid(s[i])&&l.push(a[i]-s[i]);return o.z.test(l)},o.z.twoSampleTest=function(e,t,n){var i=n?e.map(r.$(t)):e,s=n?e.map(r.$(n)):t,u=o.count.valid(i),c=o.count.valid(s),l=a.random.normal(0,1),f=o.mean(i)-o.mean(s),d=Math.sqrt(o.variance(i)/u+o.variance(s)/c);if(0===d)return 0===f?1:0;var p=f/d;return 2*l.cdf(-Math.abs(p))},o.dist.mat=function(e){var t,n,r,i=e.length,o=i*i,s=Array(o),u=a.zeros(i),c=0;for(n=0;i>n;++n)for(s[n*i+n]=0,r=n+1;i>r;++r)s[n*i+r]=t=Math.abs(e[n]-e[r]),s[r*i+n]=t,u[n]+=t,u[r]+=t;for(n=0;i>n;++n)c+=u[n],u[n]/=i;for(c/=o,n=0;i>n;++n)for(r=n;i>r;++r)s[n*i+r]+=c-u[n]-u[r],s[r*i+n]=s[n*i+r];return s},o.entropy=function(e,t){t=r.$(t);var n,i,a=0,o=0,s=e.length;for(n=0;s>n;++n)a+=t?t(e[n]):e[n];if(0===a)return 0;for(n=0;s>n;++n)i=(t?t(e[n]):e[n])/a,i&&(o+=i*Math.log(i));return-o/Math.LN2},o.mutual=function(e,t,n,i){var a,o,s,u=i?e.map(r.$(t)):e,c=i?e.map(r.$(n)):t,l=i?e.map(r.$(i)):n,f={},d={},p=l.length,g=0,m=0,h=0;for(s=0;p>s;++s)f[u[s]]=0,d[c[s]]=0;for(s=0;p>s;++s)f[u[s]]+=l[s],d[c[s]]+=l[s],g+=l[s];for(o=1/(g*Math.LN2),s=0;p>s;++s)0!==l[s]&&(a=g*l[s]/(f[u[s]]*d[c[s]]),m+=l[s]*o*Math.log(a),h+=l[s]*o*Math.log(l[s]/g));return[m,1+m/h]},o.mutual.info=function(e,t,n,r){return o.mutual(e,t,n,r)[0]},o.mutual.dist=function(e,t,n,r){return o.mutual(e,t,n,r)[1]},o.profile=function(e,t){var n,a,s,u,c,l=0,f=0,d=0,p=0,g=null,m=null,h=0,y=[],v={};for(s=0;s<e.length;++s)u=t?t(e[s]):e[s],v[u]=u in v?v[u]+1:(p+=1,1),null==u?++d:r.isValid(u)&&(c="string"==typeof u?u.length:u,(null===g||g>c)&&(g=c),(null===m||c>m)&&(m=c),n=c-l,l+=n/++f,h+=n*(c-l),y.push(c));return h/=f-1,a=Math.sqrt(h),y.sort(r.cmp),{type:i(e,t),unique:v,count:e.length,valid:f,missing:d,distinct:p,min:g,max:m,mean:l,stdev:a,median:u=o.quantile(y,.5),q1:o.quantile(y,.25),q3:o.quantile(y,.75),modeskew:0===a?0:(l-u)/a}},o.summary=function(e,t){t=t||r.keys(e[0]);var n=t.map(function(t){var n=o.profile(e,r.$(t));return n.field=t,n});return n.__summary__=!0,n},t.exports=o},{"./generate":22,"./import/type":23,"./util":26}],25:[function(e,t,n){function r(e){return c.setTime(+e),c}function i(e,t,n,r,i,a){var o={type:e,date:t,unit:n};return r?o.step=r:o.minstep=1,null!=i&&(o.min=i),null!=a&&(o.max=a),o}function a(e,t,n,r,a,o){return i(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},r,a,o)}function o(e,t,n,r){var i,a,o,s=g[0];for(i=1,a=g.length;a>i;++i)if(s=g[i],t>s[0]){if(o=t/s[0],o>r)return e[g[i-1][1]];if(o>=n)return e[s[1]]}return e[g[a-1][1]]}function s(e){var t,n,r={};for(t=0,n=e.length;n>t;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return o(e,t,n,r)},r}var u=e("d3-time"),c=new Date,l=new Date(0,0,1).setFullYear(0),f=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),d=[a("second",u.second,l),a("minute",u.minute,l),a("hour",u.hour,l),a("day",u.day,l,[1,7]),a("month",u.month,l,[1,3,6]),a("year",u.year,l),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return r(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return r(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return r(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return r(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return r(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return r(e).getMonth()},[1],0,11)],p=[a("second",u.utcSecond,f),a("minute",u.utcMinute,f),a("hour",u.utcHour,f),a("day",u.utcDay,f,[1,7]),a("month",u.utcMonth,f,[1,3,6]),a("year",u.utcYear,f),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return r(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return r(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return r(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return r(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return r(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return r(e).getUTCMonth()},[1],0,11)],g=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=s(d),t.exports.utc=s(p)},{"d3-time":20}],26:[function(e,t,n){function r(e){return e.replace(d,"$1\\'")}function i(e,t){var n,r="";for(n=0;e>n;++n)r+=t;return r}function a(e,t,n){var r=0,i=e.split(g);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,t>=r}).reverse():i.filter(function(e){return r+=e.length,t>=r}),e.length?e.join("").trim():i[0].slice(0,t)}var o=e("buffer"),s=e("./time"),u=s.utc,c=t.exports={},l="__name__";c.namedfunc=function(e,t){return t[l]=e,t},c.name=function(e){return null==e?null:e[l]},c.identity=function(e){return e},c["true"]=c.namedfunc("true",function(){return!0}),c["false"]=c.namedfunc("false",function(){return!1}),c.duplicate=function(e){return JSON.parse(JSON.stringify(e))},c.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},c.extend=function(e){for(var t,n,r=1,i=arguments.length;i>r;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},c.length=function(e){return null!=e&&null!=e.length?e.length:null},c.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},c.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},c.toMap=function(e,t){return(t=c.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},c.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;t>r;++r)n+="|"+String(e[r]);return n};var f=Object.prototype.toString;c.isObject=function(e){return e===Object(e)},c.isFunction=function(e){return"[object Function]"===f.call(e)},c.isString=function(e){return"string"==typeof value||"[object String]"===f.call(e)},c.isArray=Array.isArray||function(e){return"[object Array]"===f.call(e)},c.isNumber=function(e){return"number"==typeof e||"[object Number]"===f.call(e)},c.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},c.isDate=function(e){return"[object Date]"===f.call(e)},c.isValid=function(e){return null!=e&&e===e},c.isBuffer=o.Buffer&&o.Buffer.isBuffer||c["false"],c.number=function(e){return null==e||""===e?null:+e},c["boolean"]=function(e){return null==e||""===e?null:"false"===e?!1:!!e},c.date=function(e,t){var n=t?t:Date;return null==e||""===e?null:n.parse(e)},c.array=function(e){return null!=e?c.isArray(e)?e:[e]:[]},c.str=function(e){return c.isArray(e)?"["+e.map(c.str)+"]":c.isObject(e)?JSON.stringify(e):c.isString(e)?"'"+r(e)+"'":e};var d=/(^|[^\\])'/g,p=/\[(.*?)\]|[^.\[]+/g;c.field=function(e){return String(e).match(p).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},c.accessor=function(e){var t;return null==e||c.isFunction(e)?e:c.namedfunc(e,(t=c.field(e)).length>1?function(e){return t.reduce(function(e,t){return e[t]},e)}:function(t){return t[e]})},c.$=c.accessor,c.mutator=function(e){var t;return c.isString(e)&&(t=c.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},c.$func=function(e,t){return function(n){n=c.$(n)||c.identity;var r=e+(c.name(n)?"_"+c.name(n):"");return c.namedfunc(r,function(e){return t(n(e))})}},c.$valid=c.$func("valid",c.isValid),c.$length=c.$func("length",c.length),c.$in=function(e,t){e=c.$(e);var n=c.isArray(t)?c.toMap(t):t;return function(t){return!!n[e(t)]}},c.$year=c.$func("year",s.year.unit),c.$month=c.$func("month",s.months.unit),c.$date=c.$func("date",s.dates.unit),c.$day=c.$func("day",s.weekdays.unit),c.$hour=c.$func("hour",s.hours.unit),c.$minute=c.$func("minute",s.minutes.unit),c.$second=c.$func("second",s.seconds.unit),c.$utcYear=c.$func("utcYear",u.year.unit),c.$utcMonth=c.$func("utcMonth",u.months.unit),c.$utcDate=c.$func("utcDate",u.dates.unit),c.$utcDay=c.$func("utcDay",u.weekdays.unit),c.$utcHour=c.$func("utcHour",u.hours.unit),c.$utcMinute=c.$func("utcMinute",u.minutes.unit),c.$utcSecond=c.$func("utcSecond",u.seconds.unit),c.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=c.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),c.accessor(e)}),function(n,r){var i,a,o,s,u;for(i=0,a=e.length;a>i;++i){if(o=e[i],s=o(n),u=o(r),u>s)return-1*t[i];if(s>u)return t[i]}return 0}},c.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e?-1:null===t?1:NaN},c.numcmp=function(e,t){return e-t},c.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var a=t(e),o=t(i);return o>a?-1:a>o?1:r[n(e)]-r[n(i)]}),e},c.pad=function(e,t,n,r){r=r||" ";var a=t-e.length;if(0>=a)return e;switch(n){case"left":return i(a,r)+e;case"middle":case"center":return i(Math.floor(a/2),r)+e+i(Math.ceil(a/2),r);default:return e+i(a,r)}},c.truncate=function(e,t,n,r,i){var o=e.length;if(t>=o)return e;i=void 0!==i?String(i):"…";var s=Math.max(0,t-i.length);switch(n){case"left":return i+(r?a(e,s,1):e.slice(o-s));case"middle":case"center":var u=Math.ceil(s/2),c=Math.floor(s/2);return(r?a(e,u):e.slice(0,u))+i+(r?a(e,c,1):e.slice(o-c));default:return(r?a(e,s):e.slice(0,s))+i}};var g=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/},{"./time":25,buffer:1}],27:[function(e,t,n){n.AGGREGATE_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","modeskew","min","max","argmin","argmax"],n.SHARED_DOMAIN_OPS=["mean","average","stdev","stdevp","median","q1","q3","min","max"]},{}],28:[function(e,t,n){n.MAXBINS_DEFAULT=15},{}],29:[function(e,t,n){function r(e,t){return!!i(e)[t]}function i(e){switch(e){case n.X:case n.Y:return{point:!0,tick:!0,circle:!0,square:!0,bar:!0,line:!0,area:!0};case n.ROW:case n.COLUMN:return{point:!0,tick:!0,circle:!0,square:!0,bar:!0,line:!0,area:!0,text:!0};case n.SIZE:return{point:!0,tick:!0,circle:!0,square:!0,bar:!0,text:!0};case n.COLOR:case n.DETAIL:return{point:!0,tick:!0,circle:!0,square:!0,bar:!0,line:!0,area:!0,text:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}return{}}function a(e){switch(e){case n.X:case n.Y:case n.COLOR:return{measure:!0,dimension:!0};case n.ROW:case n.COLUMN:case n.SHAPE:case n.DETAIL:return{measure:!1,dimension:!0};case n.SIZE:case n.TEXT:return{measure:!0,dimension:!1}}throw new Error("Invalid encoding channel"+e)}!function(e){e[e.X="x"]="X",e[e.Y="y"]="Y",e[e.ROW="row"]="ROW",e[e.COLUMN="column"]="COLUMN",e[e.SHAPE="shape"]="SHAPE",e[e.SIZE="size"]="SIZE",e[e.COLOR="color"]="COLOR",e[e.TEXT="text"]="TEXT",e[e.DETAIL="detail"]="DETAIL"}(n.Channel||(n.Channel={}));var o=n.Channel;n.X=o.X,n.Y=o.Y,n.ROW=o.ROW,n.COLUMN=o.COLUMN,n.SHAPE=o.SHAPE,n.SIZE=o.SIZE,n.COLOR=o.COLOR,n.TEXT=o.TEXT,n.DETAIL=o.DETAIL,n.CHANNELS=[n.X,n.Y,n.ROW,n.COLUMN,n.SIZE,n.SHAPE,n.COLOR,n.TEXT,n.DETAIL],n.supportMark=r,n.getSupportedMark=i,n.getSupportedRole=a},{}],30:[function(e,t,n){var r=e("../bin"),i=e("../channel"),a=e("../data"),o=e("../fielddef"),s=e("../encoding"),u=e("./layout"),c=e("../mark"),l=e("../schema/schema"),f=e("../schema/schemautil"),d=e("../type"),p=e("../util"),g=e("./time"),m=function(){function e(e,t){var n=l.instantiate();this._spec=f.merge(n,t||{},e),s.forEach(this._spec.encoding,function(e,t){e.type&&(e.type=d.getFullName(e.type))}),this._stack=this.getStackProperties(),this._layout=u.compileLayout(this)}return e.prototype.getStackProperties=function(){var e=this.has(i.COLOR)?i.COLOR:this.has(i.DETAIL)?i.DETAIL:null;if(e&&(this.is(c.BAR)||this.is(c.AREA))&&this.config("stack")!==!1&&this.isAggregate()){var t=this.isMeasure(i.X),n=this.isMeasure(i.Y);if(t&&!n)return{groupbyChannel:i.Y,fieldChannel:i.X,stackChannel:e,config:this.config("stack")};if(n&&!t)return{groupbyChannel:i.X,fieldChannel:i.Y,stackChannel:e,config:this.config("stack")}}return null},e.prototype.layout=function(){return this._layout},e.prototype.stack=function(){return this._stack},e.prototype.toSpec=function(e,t){var n,r=p.duplicate(this._spec.encoding);n={mark:this._spec.mark,encoding:r},e||(n.config=p.duplicate(this._spec.config)),t||(n.data=p.duplicate(this._spec.data));var i=l.instantiate();return f.subtract(n,i)},e.prototype.mark=function(){return this._spec.mark},e.prototype.spec=function(){return this._spec},e.prototype.is=function(e){return this._spec.mark===e},e.prototype.has=function(e){return void 0!==this._spec.encoding[e].field},e.prototype.fieldDef=function(e){return this._spec.encoding[e]},e.prototype.field=function(e,t){t=t||{};var n=this.fieldDef(e),r=(t.datum?"datum.":"")+(t.prefn||""),i=n.field;if(o.isCount(n))return r+"count";if(t.fn)return r+t.fn+"_"+i;if(!t.nofn&&n.bin){var a=t.binSuffix||"_start";return r+"bin_"+i+a}return t.nofn||t.noAggregate||!n.aggregate?!t.nofn&&n.timeUnit?r+n.timeUnit+"_"+i:r+i:r+n.aggregate+"_"+i},e.prototype.fieldTitle=function(e){if(o.isCount(this._spec.encoding[e]))return o.COUNT_DISPLAYNAME;var t=this._spec.encoding[e].aggregate||this._spec.encoding[e].timeUnit||this._spec.encoding[e].bin&&"bin";return t?t.toUpperCase()+"("+this._spec.encoding[e].field+")":this._spec.encoding[e].field},e.prototype.bin=function(e){var t=this._spec.encoding[e].bin;return t==={}?!1:t===!0?{maxbins:r.MAXBINS_DEFAULT}:t},e.prototype.numberFormat=function(e){return this.config("numberFormat")},e.prototype.map=function(e){return s.map(this._spec.encoding,e)},e.prototype.reduce=function(e,t){return s.reduce(this._spec.encoding,e,t)},e.prototype.forEach=function(e){return s.forEach(this._spec.encoding,e)},e.prototype.isOrdinalScale=function(e){var t=this.fieldDef(e);return t&&(p.contains([d.NOMINAL,d.ORDINAL],t.type)||t.type===d.TEMPORAL&&t.timeUnit&&"ordinal"===g.scale.type(t.timeUnit,e))},e.prototype.isDimension=function(e){return this.has(e)&&o.isDimension(this.fieldDef(e))},e.prototype.isMeasure=function(e){return this.has(e)&&o.isMeasure(this.fieldDef(e))},e.prototype.isAggregate=function(){return s.isAggregate(this._spec.encoding)},e.prototype.isFacet=function(){return this.has(i.ROW)||this.has(i.COLUMN)},e.prototype.dataTable=function(){return this.isAggregate()?a.SUMMARY:a.SOURCE},e.prototype.data=function(){return this._spec.data},e.prototype.hasValues=function(){var e=this.data().values;return e&&e.length},e.prototype.config=function(e){return this._spec.config[e]},e.prototype.markOpacity=function(){var e=this.config("marks").opacity;return e?e:p.contains([c.POINT,c.TICK,c.CIRCLE,c.SQUARE],this.mark())&&(!this.isAggregate()||this.has(i.DETAIL)||this.has(i.COLOR)||this.has(i.SHAPE))?.7:void 0},e}();n.Model=m},{"../bin":28,"../channel":29,"../data":33,"../encoding":34,"../fielddef":35,"../mark":36,"../schema/schema":49,"../schema/schemautil":50,"../type":55,"../util":56,"./layout":31,"./time":32}],31:[function(e,t,n){function r(e){var t=i(e),n=o(e);return{cellWidth:t,cellHeight:n,width:a(e,t),height:s(e,n)}}function i(e){return e.has(u.X)?e.isOrdinalScale(u.X)?{data:l.LAYOUT,field:"cellWidth"}:e.config("cell").width:e.mark()===c.TEXT?e.config("textCellWidth"):e.fieldDef(u.X).scale.bandWidth}function a(e,t){return e.has(u.COLUMN)?{data:l.LAYOUT,field:"width"}:t}function o(e){return e.has(u.Y)?e.isOrdinalScale(u.Y)?{data:l.LAYOUT,field:"cellHeight"}:e.config("cell").height:e.fieldDef(u.Y).scale.bandWidth}function s(e,t){return e.has(u.ROW)?{data:l.LAYOUT,field:"height"}:t}var u=e("../channel"),c=e("../mark"),l=e("../data");n.compileLayout=r},{"../channel":29,"../data":33,"../mark":36}],32:[function(e,t,n){function r(e,t,n,r){var i=e.timeUnit;switch(i){case"seconds":return 60;case"minutes":return 60;case"hours":return 24;case"day":return 7;case"date":return 31;case"month":return 12;case"year":var a=t[e.field],o=t["year_"+e.field];return o?o.distinct-(a.missing>0&&n[r]?1:0):null}return null}function i(e,t){var n="utc"+e;return n+"("+t+")"}function a(e,t){void 0===t&&(t=!1);var n=t?"-abbrev":"";switch(e){case"day":return"day"+n;case"month":return"month"+n}return null}var o=e("../util"),s=e("../channel");n.cardinality=r,n.formula=i;var u;!function(e){function t(e,t){if(t===s.COLOR)return"linear";if(t===s.COLUMN||t===s.ROW)return"ordinal";switch(e){case"hours":case"day":case"date":case"month":return"ordinal";case"year":case"second":case"minute":return"linear"}return"time"}function n(e,t){var n=t===s.COLOR;switch(e){case"seconds":case"minutes":return n?[0,59]:o.range(0,60);case"hours":return n?[0,23]:o.range(0,24);case"day":return n?[0,6]:o.range(0,7);case"date":return n?[1,31]:o.range(1,32);case"month":return n?[0,11]:o.range(0,12)}return null}e.type=t,e.domain=n}(u=n.scale||(n.scale={})),n.labelTemplate=a},{"../channel":29,"../util":56}],33:[function(e,t,n){var r=e("./type");n.SUMMARY="summary",n.SOURCE="source",n.STACKED="stacked",n.LAYOUT="layout",n.types={"boolean":r.NOMINAL,number:r.QUANTITATIVE,integer:r.QUANTITATIVE,date:r.TEMPORAL,string:r.NOMINAL}},{"./type":55}],34:[function(e,t,n){function r(e){var t=0;return e.color&&t++,e.size&&t++,e.shape&&t++,t}function i(e,t){var n=e&&e[t];return n&&n.field}function a(e){for(var t in e)if(i(e,t)&&e[t].aggregate)return!0;return!1}function o(e){var t=[];return l.CHANNELS.forEach(function(n){i(e,n)&&t.push(e[n])}),t}function s(e,t){var n=0;l.CHANNELS.forEach(function(r){i(e,r)&&t(e[r],r,n++)})}function u(e,t){var n=[];return l.CHANNELS.forEach(function(r){i(e,r)&&n.push(t(e[r],r,e))}),n}function c(e,t,n){var r=n;return l.CHANNELS.forEach(function(n){i(e,n)&&(r=t(r,e[n],n,e))}),r}var l=e("./channel");n.countRetinal=r,n.has=i,n.isAggregate=a,n.fieldDefs=o,n.forEach=s,n.map=u,n.reduce=c},{"./channel":29}],35:[function(e,t,n){function r(e){return l.contains([d.NOMINAL,d.ORDINAL],e.type)||!!e.bin||e.type===d.TEMPORAL&&!!e.timeUnit}function i(e){return e&&r(e)}function a(e){return e&&!r(e)}function o(){return{field:"*",aggregate:"count",type:d.QUANTITATIVE,displayName:n.COUNT_DISPLAYNAME}}function s(e){return"count"===e.aggregate}function u(e,t,n){void 0===n&&(n={});var r=t[e.field],i=e.type;if(e.bin){var a=e.bin,o="boolean"==typeof a?c.MAXBINS_DEFAULT:a.maxbins,s=l.getbins(r,o);return(s.stop-s.start)/s.step}if(e.type===d.TEMPORAL){var u=f.cardinality(e,t,n,i);if(null!==u)return u}return e.aggregate?1:r.distinct-(r.missing>0&&n[i]?1:0)}var c=e("./bin"),l=e("./util"),f=e("./compiler/time"),d=e("./type");n.isDimension=i,n.isMeasure=a,n.count=o,n.COUNT_DISPLAYNAME="Number of Records",n.isCount=s,n.cardinality=u},{"./bin":28,"./compiler/time":32,"./type":55,"./util":56}],36:[function(e,t,n){!function(e){e[e.AREA="area"]="AREA",e[e.BAR="bar"]="BAR",e[e.LINE="line"]="LINE",e[e.POINT="point"]="POINT",e[e.TEXT="text"]="TEXT",e[e.TICK="tick"]="TICK",e[e.CIRCLE="circle"]="CIRCLE",e[e.SQUARE="square"]="SQUARE"}(n.Mark||(n.Mark={}));var r=n.Mark;n.AREA=r.AREA,n.BAR=r.BAR,n.LINE=r.LINE,n.POINT=r.POINT,n.TEXT=r.TEXT,n.TICK=r.TICK,n.CIRCLE=r.CIRCLE,n.SQUARE=r.SQUARE},{}],37:[function(e,t,n){n.axis={type:"object",properties:{format:{type:"string","default":void 0,description:"The formatting pattern for axis labels. If not undefined, this will be determined by the max value of the field."},grid:{type:"boolean","default":void 0,description:"A flag indicate if gridlines should be created in addition to ticks. If `grid` is unspecified, the default value is `true` for ROW and COL. For X and Y, the default value is `true` for quantitative and time fields and `false` otherwise."},layer:{type:"string","default":void 0,description:"A string indicating if the axis (and any gridlines) should be placed above or below the data marks."},orient:{type:"string","default":void 0,"enum":["top","right","left","bottom"],description:"The orientation of the axis. One of top, bottom, left or right. The orientation can be used to further specialize the axis type (e.g., a y axis oriented for the right edge of the chart)."},ticks:{type:"integer","default":void 0,minimum:0,description:'A desired number of ticks, for axes visualizing quantitative scales. The resulting number may be different so that values are "nice" (multiples of 2, 5, 10) and lie within the underlying scale\'s range.'},title:{type:"string","default":void 0,description:"A title for the axis. (Shows field name and its function by default.)"},labelMaxLength:{type:"integer","default":25,minimum:0,description:"Truncate labels that are too long."},titleMaxLength:{type:"integer","default":void 0,minimum:0,description:"Max length for axis title if the title is automatically generated from the field's description"},titleOffset:{type:"integer","default":void 0,description:"A title offset value for the axis."},shortTimeNames:{type:"boolean","default":!1,description:"Whether month names and weekday names should be abbreviated."},properties:{type:"object","default":void 0,description:"Optional mark property definitions for custom axis styling."}}}},{}],38:[function(e,t,n){var r=e("../bin"),i=e("../type"),a=e("../util");n.bin={type:["boolean","object"],"default":!1,properties:{maxbins:{type:"integer","default":r.MAXBINS_DEFAULT,minimum:2,description:"Maximum number of bins."}},supportedTypes:a.toMap([i.QUANTITATIVE])}},{"../bin":28,"../type":55,"../util":56}],39:[function(e,t,n){n.cellConfig={type:"object",properties:{width:{type:"integer","default":200},height:{type:"integer","default":200},padding:{type:"integer","default":16,description:"default padding between facets."},gridColor:{type:"string",role:"color","default":"#000000"},gridOpacity:{type:"number",minimum:0,maximum:1,"default":.25},gridOffset:{type:"number","default":6},fill:{type:"string",role:"color","default":"rgba(0,0,0,0)"},fillOpacity:{type:"number"},stroke:{type:"string",role:"color"},strokeWidth:{type:"integer"},strokeOpacity:{type:"number"},strokeDash:{type:"array","default":void 0},strokeDashOffset:{type:"integer",description:"The offset (in pixels) into which to begin drawing with the stroke dash array."}}}},{}],40:[function(e,t,n){n.marksConfig={type:"object",properties:{filled:{type:"boolean","default":!1,description:"Whether the shape's color should be used as fill color instead of stroke color."},format:{type:"string","default":"",description:"The formatting pattern for text value.If not defined, this will be determined automatically"},fill:{type:"string",role:"color","default":"#000000"},opacity:{type:"number","default":void 0,minimum:0,maximum:1},strokeWidth:{type:"integer","default":2,minimum:0},strokeDash:{type:"array","default":void 0,description:"An array of alternating stroke, space lengths for creating dashed or dotted lines."},strokeDashOffset:{type:"array","default":void 0,description:"The offset (in pixels) into which to begin drawing with the stroke dash array."},orient:{type:"string","default":void 0,description:"The orientation of this area mark. One of horizontal (the default) or vertical."},interpolate:{type:"string","default":void 0,description:"The line interpolation method to use. One of linear, step-before, step-after, basis, basis-open, basis-closed, bundle, cardinal, cardinal-open, cardinal-closed, monotone."},tension:{type:"number","default":void 0,description:"Depending on the interpolation type, sets the tension parameter."},align:{type:"string","default":"right","enum":["left","right","center"],description:"The horizontal alignment of the text. One of left, right, center."},angle:{type:"number","default":void 0,description:"The rotation angle of the text, in degrees."},baseline:{type:"string","default":"middle","enum":["top","middle","bottom"],description:"The vertical alignment of the text. One of top, middle, bottom."},dx:{type:"number","default":void 0,description:"The horizontal offset, in pixels, between the text label and its anchor point. The offset is applied after rotation by the angle property."
},dy:{type:"number","default":void 0,description:"The vertical offset, in pixels, between the text label and its anchor point. The offset is applied after rotation by the angle property."},font:{type:"string","default":void 0,role:"font",description:"The typeface to set the text in (e.g., Helvetica Neue)."},fontStyle:{type:"string","default":void 0,"enum":["normal","italic"],description:"The font style (e.g., italic)."},fontWeight:{type:"string","enum":["normal","bold"],"default":void 0,description:"The font weight (e.g., bold)."},radius:{type:"number","default":void 0,description:"Polar coordinate radial offset, in pixels, of the text label from the origin determined by the x and y properties."},theta:{type:"number","default":void 0,description:'Polar coordinate angle, in radians, of the text label from the origin determined by the x and y properties. Values for theta follow the same convention of arc mark startAngle and endAngle properties: angles are measured in radians, with 0 indicating "north".'}}}},{}],41:[function(e,t,n){var r=e("./config.stack.schema"),i=e("./config.cell.schema"),a=e("./config.marks.schema");n.config={type:"object",properties:{viewport:{type:"array",items:{type:"integer"},"default":void 0,description:"The width and height of the on-screen viewport, in pixels. If necessary, clipping and scrolling will be applied."},background:{type:"string",role:"color","default":void 0,description:'CSS color property to use as background of visualization. Default is `"transparent"`.'},scene:{type:"object","default":void 0,description:"An object to style the top-level scenegraph root. Available properties include `fill`, `fillOpacity`, `stroke`, `strokeOpacity`, `strokeWidth`, `strokeDash`, `strokeDashOffset`"},filterNull:{type:"object",properties:{nominal:{type:"boolean","default":!1},ordinal:{type:"boolean","default":!1},quantitative:{type:"boolean","default":!0},temporal:{type:"boolean","default":!0}}},textCellWidth:{type:"integer","default":90,minimum:0},sortLineBy:{type:"string","default":void 0,description:"Data field to sort line by. '-' prefix can be added to suggest descending order."},stack:r.stackConfig,cell:i.cellConfig,marks:a.marksConfig,singleBarOffset:{type:"integer","default":5,minimum:0},characterWidth:{type:"integer","default":6},numberFormat:{type:"string","default":"s",description:"D3 Number format for axis labels and text tables."},timeFormat:{type:"string","default":"%Y-%m-%d",description:"Date format for axis labels."}}}},{"./config.cell.schema":39,"./config.marks.schema":40,"./config.stack.schema":42}],42:[function(e,t,n){n.stackConfig={type:["boolean","object"],"default":{},description:"Enable stacking (for bar and area marks only).",properties:{sort:{oneOf:[{type:"string","enum":["ascending","descending"]},{type:"array",items:{type:"string"}}],description:'Order of the stack. This can be either a string (either "descending" or "ascending")or a list of fields to determine the order of stack layers.By default, stack uses descending order.'},offset:{type:"string","enum":["zero","center","normalize"]}}}},{}],43:[function(e,t,n){n.data={type:"object",properties:{formatType:{type:"string","enum":["json","csv","tsv"],"default":"json"},url:{type:"string","default":void 0},values:{type:"array","default":void 0,description:"Pass array of objects instead of a url to a file.",items:{type:"object",additionalProperties:!0}},filter:{type:"string","default":void 0,description:"A string containing the filter Vega expression. Use `datum` to refer to the current data object."},calculate:{type:"array","default":void 0,description:"Calculate new field(s) using the provided expresssion(s). Calculation are applied before filter.",items:{type:"object",properties:{field:{type:"string",description:"The field in which to store the computed formula value."},expr:{type:"string",description:"A string containing an expression for the formula. Use the variable `datum` to to refer to the current data object."}}}}}}},{}],44:[function(e,t,n){var r=e("./schemautil"),i=e("../util"),a=e("./axis.schema"),o=e("./legend.schema"),s=e("./sort.schema"),u=e("./fielddef.schema"),c={required:["field","type"]},l=r.merge(i.duplicate(u.typicalField),c,{properties:{scale:{properties:{padding:{"default":1},bandWidth:{"default":21}}},axis:a.axis,sort:s.sort}}),f=i.duplicate(l),d=r.merge(i.duplicate(u.onlyOrdinalField),c,{properties:{axis:a.axis,sort:s.sort}}),p=r.merge(i.duplicate(d)),g=r.merge(i.duplicate(d)),m=r.merge(i.duplicate(u.typicalField),{properties:{legend:o.legend,sort:s.sort,value:{type:"integer","default":30,minimum:0,description:"Size of marks."}}}),h=r.merge(i.duplicate(u.typicalField),{properties:{legend:o.legend,sort:s.sort,value:{type:"string",role:"color","default":"#4682b4",description:"Color to be used for marks."},scale:{type:"object",properties:{quantitativeRange:{type:"array","default":["#AFC6A3","#09622A"],description:"Color range to encode quantitative variables.",minItems:2,maxItems:2,items:{type:"string",role:"color"}}}}}}),y=r.merge(i.duplicate(u.onlyOrdinalField),{properties:{legend:o.legend,sort:s.sort,value:{type:"string","enum":["circle","square","cross","diamond","triangle-up","triangle-down"],"default":"circle",description:"Mark to be used."}}}),v=r.merge(i.duplicate(u.onlyOrdinalField),{properties:{sort:s.sort}}),b=r.merge(i.duplicate(u.typicalField),{properties:{sort:s.sort,value:{type:"string","default":"Abc"}}});n.encoding={type:"object",properties:{x:l,y:f,row:p,column:g,size:m,color:h,shape:y,text:b,detail:v}}},{"../util":56,"./axis.schema":37,"./fielddef.schema":45,"./legend.schema":46,"./schemautil":50,"./sort.schema":51}],45:[function(e,t,n){var r=e("./bin.schema"),i=e("./scale.schema"),a=e("../aggregate"),o=e("../util"),s=e("./schemautil"),u=e("../timeunit"),c=e("../type");n.fieldDef={type:"object",properties:{field:{type:"string"},type:{type:"string","enum":[c.NOMINAL,c.ORDINAL,c.QUANTITATIVE,c.TEMPORAL]},timeUnit:{type:"string","enum":u.TIMEUNITS,supportedTypes:o.toMap([c.TEMPORAL])},bin:r.bin}},n.aggregate={type:"string","enum":a.AGGREGATE_OPS,supportedEnums:{quantitative:a.AGGREGATE_OPS,ordinal:["median","min","max"],nominal:[],temporal:["mean","median","min","max"],"":["count"]},supportedTypes:o.toMap([c.QUANTITATIVE,c.NOMINAL,c.ORDINAL,c.TEMPORAL,""])},n.typicalField=s.merge(o.duplicate(n.fieldDef),{properties:{aggregate:n.aggregate,scale:i.typicalScale}}),n.onlyOrdinalField=s.merge(o.duplicate(n.fieldDef),{properties:{scale:i.ordinalOnlyScale}})},{"../aggregate":27,"../timeunit":54,"../type":55,"../util":56,"./bin.schema":38,"./scale.schema":48,"./schemautil":50}],46:[function(e,t,n){n.legend={"default":!0,description:"Properties of a legend or boolean flag for determining whether to show it.",oneOf:[{type:"object",properties:{orient:{type:"string","default":void 0,description:'The orientation of the legend. One of "left" or "right". This determines how the legend is positioned within the scene. The default is "right".'},title:{type:"string","default":void 0,description:"A title for the legend. (Shows field name and its function by default.)"},format:{type:"string","default":void 0,description:"An optional formatting pattern for legend labels. Vega uses D3's format pattern."},values:{type:"array","default":void 0,description:"Explicitly set the visible legend values."},properties:{type:"object","default":void 0,description:"Optional mark property definitions for custom legend styling. "}}},{type:"boolean"}]}},{}],47:[function(e,t,n){n.mark={type:"string","enum":["point","tick","bar","line","area","circle","square","text"]}},{}],48:[function(e,t,n){var r=e("../util"),i=e("./schemautil"),a=e("../type"),o={type:"object",properties:{type:{type:"string","enum":["linear","log","pow","sqrt","quantile"],"default":"linear",supportedTypes:r.toMap([a.QUANTITATIVE])},domain:{"default":void 0,type:["array","object"],description:"The domain of the scale, representing the set of data values. For quantitative data, this can take the form of a two-element array with minimum and maximum values. For ordinal/categorical data, this may be an array of valid input values. The domain may also be specified by a reference to a data source."},range:{"default":void 0,type:["array","object","string"],description:"The range of the scale, representing the set of visual values. For numeric values, the range can take the form of a two-element array with minimum and maximum values. For ordinal or quantized data, the range may by an array of desired output values, which are mapped to elements in the specified domain. For ordinal scales only, the range can be defined using a DataRef: the range values are then drawn dynamically from a backing data set."},round:{"default":void 0,type:"boolean",description:"If true, rounds numeric output values to integers. This can be helpful for snapping to the pixel grid."}}},s={properties:{bandWidth:{type:"integer",minimum:0,"default":void 0},outerPadding:{type:"number","default":void 0},padding:{type:"number","default":void 0,description:"Applies spacing among ordinal elements in the scale range. The actual effect depends on how the scale is configured. If the __points__ parameter is `true`, the padding value is interpreted as a multiple of the spacing between points. A reasonable value is 1.0, such that the first and last point will be offset from the minimum and maximum value by half the distance between points. Otherwise, padding is typically in the range [0, 1] and corresponds to the fraction of space in the range interval to allocate to padding. A value of 0.5 means that the range band width will be equal to the padding width. For more, see the [D3 ordinal scale documentation](https://github.com/mbostock/d3/wiki/Ordinal-Scales)."},points:{type:"boolean","default":void 0,description:"If true, distributes the ordinal values over a quantitative range at uniformly spaced points. The spacing of the points can be adjusted using the padding property. If false, the ordinal scale will construct evenly-spaced bands, rather than points."}}},u={properties:{clamp:{type:"boolean","default":!0,description:"If true, values that exceed the data domain are clamped to either the minimum or maximum range value"},nice:{"default":void 0,oneOf:[{type:"boolean",description:"If true, modifies the scale domain to use a more human-friendly number range (e.g., 7 instead of 6.96)."},{type:"string","enum":["second","minute","hour","day","week","month","year"],description:'If specified, modifies the scale domain to use a more human-friendly value range. For time and utc scale types only, the nice value should be a string indicating the desired time interval; legal values are "second", "minute", "hour", "day", "week", "month", or "year".'}],supportedTypes:r.toMap([a.QUANTITATIVE,a.TEMPORAL]),description:""},exponent:{type:"number","default":void 0,description:"Sets the exponent of the scale transformation. For pow scale types only, otherwise ignored."},zero:{type:"boolean",description:"If true, ensures that a zero baseline value is included in the scale domain. This option is ignored for non-quantitative scales.","default":void 0,supportedTypes:r.toMap([a.QUANTITATIVE,a.TEMPORAL])},useRawDomain:{type:"boolean","default":!1,description:"Uses the source data range as scale domain instead of aggregated data for aggregate axis. This option does not work with sum or count aggregateas they might have a substantially larger scale range."}}};n.ordinalOnlyScale=i.merge(r.duplicate(o),s),n.typicalScale=i.merge(r.duplicate(o),s,u)},{"../type":55,"../util":56,"./schemautil":50}],49:[function(e,t,n){function r(){return i.instantiate(n.schema)}var i=e("./schemautil"),a=e("./mark.schema"),o=e("./config.schema"),s=e("./data.schema"),u=e("./encoding.schema"),c=e("./fielddef.schema");n.aggregate=c.aggregate,n.util=i,n.schema={$schema:"http://json-schema.org/draft-04/schema#",description:"Schema for Vega-lite specification",type:"object",required:["mark","encoding"],properties:{name:{type:"string"},description:{type:"string"},data:s.data,mark:a.mark,encoding:u.encoding,config:o.config}},n.instantiate=r},{"./config.schema":41,"./data.schema":43,"./encoding.schema":44,"./fielddef.schema":45,"./mark.schema":47,"./schemautil":50}],50:[function(e,t,n){function r(e){return 0===Object.keys(e).length}function i(e,t){return s(a(t),e)}function a(e){var t;if(void 0!==e){if("default"in e)return t=e["default"],c.isObject(t)?c.duplicate(t):t;if("object"===e.type){var n={};for(var r in e.properties)t=a(e.properties[r]),void 0!==t&&(n[r]=t);return n}"array"===e.type}}function o(e,t){var n={};for(var i in e){var a=t[i],s=e[i];if(!t||a!==s)if("object"==typeof s&&!c.isArray(s)&&a){var u=o(s,a);r(u)||(n[i]=u)}else if(c.isArray(s)){if(c.isArray(a)&&s.length===a.length){for(var l=!0,f=0;f<s.length;f++)if(s[f]!==a[f]){l=!1;break}if(l)continue}n[i]=s}else n[i]=s}return n}function s(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++)e=u(e,t[r]);return e}function u(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=s(t[n].constructor===Array?[]:{},t[n]):s(e[n],t[n]));return e}var c=e("../util");n.extend=i,n.instantiate=a,n.subtract=o,n.merge=s},{"../util":56}],51:[function(e,t,n){var r=e("../aggregate"),i=e("../type"),a=e("../util");n.sort={"default":"ascending",supportedTypes:a.toMap([i.QUANTITATIVE,i.ORDINAL]),oneOf:[{type:"string","enum":["ascending","descending","unsorted"]},{type:"object",required:["field","op"],properties:{field:{type:"string",description:"The field name to aggregate over."},op:{type:"string","enum":r.AGGREGATE_OPS,description:"The field name to aggregate over."},order:{type:"string","enum":["ascending","descending"]}}}]}},{"../aggregate":27,"../type":55,"../util":56}],52:[function(e,t,n){function r(e){return"mark"+n.ASSIGN+e.mark+n.DELIM+a(e.encoding)}function i(e,t,r){var i=e.split(n.DELIM),a=i.shift().split(n.ASSIGN)[1].trim(),s=o(i.join(n.DELIM)),u={mark:g.Mark[a],encoding:s};return void 0!==t&&(u.data=t),void 0!==r&&(u.config=r),u}function a(e){return p.map(e,function(e,t){return t+n.ASSIGN+s(e)}).join(n.DELIM)}function o(e){return e.split(n.DELIM).reduce(function(e,t){var r=t.split(n.ASSIGN),i=r[0].trim(),a=r[1];return e[i]=c(a),e},{})}function s(e){return(e.aggregate?e.aggregate+n.FUNC:"")+(e.timeUnit?e.timeUnit+n.FUNC:"")+(e.bin?"bin"+n.FUNC:"")+(e.field||"")+n.TYPE+d.SHORT_TYPE[e.type]}function u(e,t){return void 0===t&&(t=n.DELIM),e.map(s).join(t)}function c(e){var t,r=e.split(n.TYPE),i={field:r[0].trim(),type:d.TYPE_FROM_SHORT_TYPE[r[1].trim()]};for(t in l.AGGREGATE_OPS){var a=l.AGGREGATE_OPS[t];if(0===i.field.indexOf(a+"_")){i.field=i.field.substr(a.length+1),"count"===a&&0===i.field.length&&(i.field="*"),i.aggregate=a;break}}for(t in f.TIMEUNITS){var o=f.TIMEUNITS[t];if(i.field&&0===i.field.indexOf(o+"_")){i.field=i.field.substr(i.field.length+1),i.timeUnit=o;break}}return i.field&&0===i.field.indexOf("bin_")&&(i.field=i.field.substr(4),i.bin=!0),i}var l=e("./aggregate"),f=e("./timeunit"),d=e("./type"),p=e("./encoding"),g=e("./mark");n.DELIM="|",n.ASSIGN="=",n.TYPE=",",n.FUNC="_",n.shorten=r,n.parse=i,n.shortenEncoding=a,n.parseEncoding=o,n.shortenFieldDef=s,n.shortenFieldDefs=u,n.parseFieldDef=c},{"./aggregate":27,"./encoding":34,"./mark":36,"./timeunit":54,"./type":55}],53:[function(e,t,n){function r(e){return l.isAggregate(e.encoding)}function i(e){return l.fieldDefs(e.encoding)}function a(e){return new u.Model(e).toSpec(!0)}function o(e){return(l.has(e.encoding,c.COLOR)||l.has(e.encoding,c.SHAPE))&&(e.mark===f.BAR||e.mark===f.AREA)&&(!e.config||!e.config.stack!=!1)&&l.isAggregate(e.encoding)}function s(e){var t=e.encoding,n=d.duplicate(e.encoding);return n.x=t.y,n.y=t.x,n.row=t.column,n.column=t.row,e.encoding=n,e}var u=e("./compiler/Model"),c=e("./channel"),l=e("./encoding"),f=e("./mark"),d=e("./util");n.alwaysNoOcclusion=r,n.fieldDefs=i,n.getCleanSpec=a,n.isStack=o,n.transpose=s},{"./channel":29,"./compiler/Model":30,"./encoding":34,"./mark":36,"./util":56}],54:[function(e,t,n){n.TIMEUNITS=["year","month","day","date","hours","minutes","seconds"]},{}],55:[function(e,t,n){function r(e){var t=e;return n.TYPE_FROM_SHORT_TYPE[t.toUpperCase()]||t.toLowerCase()}!function(e){e[e.QUANTITATIVE="quantitative"]="QUANTITATIVE",e[e.ORDINAL="ordinal"]="ORDINAL",e[e.TEMPORAL="temporal"]="TEMPORAL",e[e.NOMINAL="nominal"]="NOMINAL"}(n.Type||(n.Type={}));var i=n.Type;n.QUANTITATIVE=i.QUANTITATIVE,n.ORDINAL=i.ORDINAL,n.TEMPORAL=i.TEMPORAL,n.NOMINAL=i.NOMINAL,n.SHORT_TYPE={quantitative:"Q",temporal:"T",nominal:"N",ordinal:"O"},n.TYPE_FROM_SHORT_TYPE={Q:n.QUANTITATIVE,T:n.TEMPORAL,O:n.ORDINAL,N:n.NOMINAL},n.getFullName=r},{}],56:[function(e,t,n){function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}function i(e,t){return e.indexOf(t)>-1}function a(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)}function o(e,t,n,r){if(e.reduce)return e.reduce.call(r,t,n);for(var i in e)n=t.call(r,n,e[i],i,e);return n}function s(e,t,n){if(e.map)return e.map.call(n,t);var r=[];for(var i in e)r.push(t.call(n,e[i],i,e));return r}function u(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1}function c(e,t){var n,r=0;for(n in e)if(!t(e[n],n,r++))return!1;return!0}function l(e,t){return d({min:e.min,max:e.max,maxbins:t})}function f(e){console.error("[VL Error]",e)}r(e("datalib/src/util")),r(e("datalib/src/generate")),r(e("datalib/src/stats")),n.contains=i,n.forEach=a,n.reduce=o,n.map=s,n.any=u,n.all=c;var d=e("datalib/src/bins/bins");n.getbins=l,n.error=f},{"datalib/src/bins/bins":21,"datalib/src/generate":22,"datalib/src/stats":24,"datalib/src/util":26}],57:[function(e,t,n){function r(e,t,r){void 0===t&&(t=n.DEFAULT_REQUIRED_CHANNEL_MAP),void 0===r&&(r=n.DEFAULT_SUPPORTED_CHANNEL_TYPE);var i=e.mark,o=e.encoding,s=t[i],u=r[i];for(var c in s)if(!(s[c]in o))return'Missing encoding channel "'+s[c]+'" for mark "'+i+'"';for(var l in o)if(!u[l])return'Encoding channel "'+l+'" is not supported by mark type "'+i+'"';return i!==a.BAR||o.x||o.y?null:"Missing both x and y for bar"}var i=e("./util"),a=e("./mark");n.DEFAULT_REQUIRED_CHANNEL_MAP={text:["text"],line:["x","y"],area:["x","y"]},n.DEFAULT_SUPPORTED_CHANNEL_TYPE={bar:i.toMap(["row","column","x","y","size","color","detail"]),line:i.toMap(["row","column","x","y","color","detail"]),area:i.toMap(["row","column","x","y","color","detail"]),tick:i.toMap(["row","column","x","y","color","detail"]),circle:i.toMap(["row","column","x","y","color","size","detail"]),square:i.toMap(["row","column","x","y","color","size","detail"]),point:i.toMap(["row","column","x","y","color","size","detail","shape"]),text:i.toMap(["row","column","size","color","text"])},n.getEncodingMappingError=r},{"./mark":36,"./util":56}]},{},[10])(10)});
//# sourceMappingURL=compass.min.js.map
